<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ì¸ì˜ ì•„ë§ˆì¡´ ìˆ˜í•™ ëª¨í—˜</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Nanum Gothic', sans-serif; background: #87CEEB; }
        #game-container { position: relative; width: 100vw; height: 100vh; background: linear-gradient(#1e4d2b, #87CEEB); overflow: hidden; }
        
        /* ë°°ê²½ ìš”ì†Œ */
        .tree { position: absolute; left: 50%; bottom: 0; width: 200px; height: 100%; background: #5d4037; transform: translateX(-50%); z-index: 1; }
        .stair { position: absolute; width: 100px; height: 10px; background: #bdbdbd; border-radius: 5px; z-index: 2; transition: all 0.5s; }
        
        /* ìºë¦­í„° ë° íš¨ê³¼ */
        #rabbit { position: absolute; font-size: 50px; z-index: 10; transition: bottom 0.5s, left 0.5s, transform 0.3s; }
        .monster { position: absolute; font-size: 60px; z-index: 9; display: none; }
        .friend { position: absolute; font-size: 40px; z-index: 5; }
        
        /* UI ìš”ì†Œ */
        #ui-layer { position: absolute; top: 20px; width: 100%; display: flex; flex-direction: column; align-items: center; z-index: 20; }
        #quiz-box { display: none; background: rgba(255, 255, 255, 0.9); padding: 20px; border-radius: 20px; border: 4px solid #4CAF50; text-align: center; width: 300px; }
        #timer { font-size: 24px; color: #ff5722; font-weight: bold; }
        #message { font-size: 18px; margin: 10px 0; color: #333; }
        input { font-size: 24px; width: 100px; text-align: center; border-radius: 10px; border: 2px solid #ccc; margin: 10px; }
        button { font-size: 20px; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 10px; cursor: pointer; }
        
        /* ì—°ì¶œ íš¨ê³¼ */
        .sparkle { position: absolute; pointer-events: none; animation: flash 0.5s ease-out; }
        @keyframes flash { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(2); } }
        .star { position: absolute; font-size: 30px; animation: fall 2s linear forwards; }
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }
        .sweat { position: absolute; font-size: 20px; top: -10px; right: -10px; animation: drip 1s infinite; }
        @keyframes drip { 0% { opacity: 1; } 100% { opacity: 0; transform: translateY(10px); } }
    </style>
</head>
<body>

<div id="game-container">
    <div class="tree"></div>
    <div id="rabbit">ğŸ°</div>
    <div id="monster-teacher" class="monster">ğŸ§™â€â™‚ï¸</div>
    
    <div id="ui-layer">
        <div id="quiz-box">
            <div id="teacher-speech"></div>
            <div id="timer">20</div>
            <div id="question" style="font-size: 32px; margin: 15px;"></div>
            <input type="number" id="answer-input" onkeypress="if(event.keyCode==13) checkAnswer()">
            <button onclick="checkAnswer()">ì œì¶œí•˜ê¸°</button>
        </div>
        <div id="final-stats" style="display:none; background:white; padding:30px; border-radius:20px; text-align:center;">
            <h1>ê²Œì„ ê²°ê³¼</h1>
            <p id="score-text" style="font-size:24px;"></p>
            <div id="reward-box"></div>
            <button onclick="location.reload()">ë‹¤ì‹œ í•˜ê¸°</button>
        </div>
    </div>
</div>

<script>
    const rabbit = document.getElementById('rabbit');
    const quizBox = document.getElementById('quiz-box');
    const teacherSpeech = document.getElementById('teacher-speech');
    const questionEl = document.getElementById('question');
    const timerEl = document.getElementById('timer');
    const inputEl = document.getElementById('answer-input');
    const monsterTeacher = document.getElementById('monster-teacher');
    const statsEl = document.getElementById('final-stats');

    let currentLevel = 1;
    let score = 0;
    let timeLeft = 20;
    let timerInterval;
    let correctAnswer = 0;
    const totalLevels = 20;

    // ì´ˆê¸° ìœ„ì¹˜ ì„¤ì •
    function init() {
        rabbit.style.bottom = '100px';
        rabbit.style.left = '40%';
        moveRabbit();
    }

    // í† ë¼ ì´ë™ (ê³„ë‹¨ ì˜¤ë¥´ê¸° ì—°ì¶œ)
    async function moveRabbit() {
        if (currentLevel > totalLevels) return finishGame();

        // ì‘ì› ë™ë¬¼ ë“±ì¥ (ëœë¤ í™•ë¥ )
        if (Math.random() > 0.6) spawnFriend();

        // 3ì´ˆê°„ ë•€ í˜ë¦¬ë©° ì˜¬ë¼ê°€ê¸°
        rabbit.innerHTML = 'ğŸ°<span class="sweat">ğŸ’¦</span>';
        for(let i=0; i<3; i++) {
            rabbit.style.bottom = (parseInt(rabbit.style.bottom) + 20) + 'px';
            await new Promise(r => setTimeout(r, 1000));
        }
        rabbit.innerHTML = 'ğŸ°';

        showMonster();
    }

    // ê´´ë¬¼ ì„ ìƒë‹˜ ë“±ì¥
    function showMonster() {
        monsterTeacher.style.display = 'block';
        monsterTeacher.style.bottom = (parseInt(rabbit.style.bottom) + 50) + 'px';
        monsterTeacher.style.left = '50%';
        
        teacherSpeech.innerText = "ì•ˆë…• ì •ì•„ì¸! ë¬¸ì œë¥¼ ë§íˆë©´ ë” ì˜¬ë¼ê°ˆ ìˆ˜ ìˆì–´. í•˜ì§€ë§Œ í‹€ë¦¬ë©´ ë§ˆë²•ìœ¼ë¡œ ì‚¬ë¼ì§€ê²Œ í•  ê±°ì•¼!";
        quizBox.style.display = 'block';
        generateQuestion();
        startTimer();
    }

    // ë¬¸ì œ ìƒì„± (1í•™ë…„ ìˆ˜ì¤€ ë‚œì´ë„ ì¡°ì ˆ)
    function generateQuestion() {
        let n1, n2;
        if (currentLevel <= 7) { // í•œìë¦¬ ìˆ˜
            n1 = Math.floor(Math.random() * 9) + 1;
            n2 = Math.floor(Math.random() * 9) + 1;
        } else if (currentLevel <= 14) { // í•œìë¦¬ + ë‘ìë¦¬
            n1 = Math.floor(Math.random() * 9) + 1;
            n2 = Math.floor(Math.random() * 40) + 10;
        } else { // ë‘ìë¦¬ + ë‘ìë¦¬
            n1 = Math.floor(Math.random() * 40) + 10;
            n2 = Math.floor(Math.random() * 40) + 10;
        }
        correctAnswer = n1 + n2;
        questionEl.innerText = `${n1} + ${n2} = ?`;
        inputEl.value = '';
        inputEl.focus();
    }

    function startTimer() {
        timeLeft = 20;
        timerEl.innerText = timeLeft;
        timerInterval = setInterval(() => {
            timeLeft--;
            timerEl.innerText = timeLeft;
            if (timeLeft === 10 || timeLeft === 5) {
                showVisualEffect("ëµ!", "#ffeb3b");
            }
            if (timeLeft <= 0) {
                gameOver("ì‹œê°„ì´ ë‹¤ ëì–´!");
            }
        }, 1000);
    }

    function checkAnswer() {
        const userAns = parseInt(inputEl.value);
        clearInterval(timerInterval);
        
        if (userAns === correctAnswer) {
            score++;
            currentLevel++;
            celebrate();
        } else {
            gameOver("ì•—! ì •ë‹µì´ ì•„ë‹ˆì•¼.");
        }
    }

    function celebrate() {
        quizBox.style.display = 'none';
        monsterTeacher.style.display = 'none';
        
        // í´ì§ ì í”„ íš¨ê³¼
        rabbit.style.transform = 'translateY(-50px) scale(1.2)';
        showVisualEffect("âœ¨ë°˜ì§âœ¨", "#fff176");
        
        setTimeout(() => {
            rabbit.style.transform = 'translateY(0) scale(1)';
            moveRabbit();
        }, 1000);
    }

    function showVisualEffect(text, color) {
        const effect = document.createElement('div');
        effect.className = 'sparkle';
        effect.style.left = '50%';
        effect.style.top = '40%';
        effect.style.color = color;
        effect.style.fontSize = '40px';
        effect.style.fontWeight = 'bold';
        effect.innerText = text;
        document.body.appendChild(effect);
        setTimeout(() => effect.remove(), 800);
    }

    function spawnFriend() {
        const friends = ['ğŸ¶', 'ğŸ±', 'ğŸ¦Š', 'ğŸ¿ï¸', 'ğŸ¼'];
        const friend = document.createElement('div');
        friend.className = 'friend';
        friend.innerText = friends[Math.floor(Math.random()*friends.length)];
        friend.style.left = (Math.random() * 20 + 10) + '%';
        friend.style.bottom = (parseInt(rabbit.style.bottom) + 30) + 'px';
        document.body.appendChild(friend);
        
        const cheer = document.createElement('div');
        cheer.style.position = 'absolute';
        cheer.style.fontSize = '14px';
        cheer.style.bottom = '40px';
        cheer.innerText = "ì•„ì¸ì•„ í˜ë‚´!";
        friend.appendChild(cheer);

        setTimeout(() => friend.remove(), 3000);
    }

    function gameOver(msg) {
        clearInterval(timerInterval);
        showVisualEffect("ì•—!", "#f44336");
        rabbit.style.display = 'none';
        finishGame();
    }

    function finishGame() {
        quizBox.style.display = 'none';
        monsterTeacher.style.display = 'none';
        statsEl.style.display = 'block';
        
        const finalScore = (score / totalLevels) * 100;
        document.getElementById('score-text').innerText = `ì •ì•„ì¸ ì–´ë¦°ì´ëŠ” ${totalLevels}ë¬¸ì œ ì¤‘ ${score}ë¬¸ì œë¥¼ ë§ì·„ì–´ìš”!\nì ìˆ˜: ${finalScore}ì `;
        
        if (score === totalLevels) {
            document.getElementById('reward-box').innerHTML = "<h2 style='color:#ff9800;'>ğŸ ì†Œì›ê¶Œ íšë“! ğŸ</h2>";
            startStarRain();
        }
    }

    function startStarRain() {
        setInterval(() => {
            const star = document.createElement('div');
            star.className = 'star';
            star.innerText = 'â­';
            star.style.left = Math.random() * 100 + 'vw';
            star.style.top = '-50px';
            document.body.appendChild(star);
            setTimeout(() => star.remove(), 2000);
        }, 100);
    }

    init();
</script>
</body>
</html>