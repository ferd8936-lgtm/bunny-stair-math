<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì •ì•„ì¸ì˜ ì•„ë§ˆì¡´ ìˆ˜í•™ ëª¨í—˜</title>
    <style>
        :root { --tree-color: #5d4037; --leaf-color: #2e7d32; }
        body { margin: 0; overflow: hidden; font-family: 'Malgun Gothic', sans-serif; background: #87CEEB; }
        
        #game-container { 
            position: relative; width: 100vw; height: 100vh; 
            background: linear-gradient(#004d40, #4db6ac, #81d4fa); 
            overflow: hidden; 
        }

        /* ê±°ëŒ€í•œ ë‚˜ë¬´ì™€ ë‚˜ì„ í˜• ë°°ê²½ */
        .giant-tree {
            position: absolute; left: 50%; bottom: -100px;
            width: 250px; height: 120%;
            background: linear-gradient(to right, #4e342e, #6d4c41, #4e342e);
            transform: translateX(-50%); z-index: 1;
            border-radius: 50px 50px 0 0;
        }

        /* ê³„ë‹¨ ìŠ¤íƒ€ì¼ */
        .stair {
            position: absolute; width: 120px; height: 20px;
            background: linear-gradient(#fff176, #fbc02d);
            border-radius: 10px; z-index: 2;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            display: flex; justify-content: center; align-items: center;
        }

        /* ìºë¦­í„°: ê·€ì—¬ìš´ í† ë¼ */
        #rabbit {
            position: absolute; font-size: 60px; z-index: 10;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(2px 4px 5px rgba(0,0,0,0.3));
            user-select: none;
        }

        /* ê´´ë¬¼ ì„ ìƒë‹˜ */
        #monster {
            position: absolute; font-size: 70px; z-index: 9;
            display: none; filter: drop-shadow(2px 4px 5px rgba(0,0,0,0.3));
        }

        /* ì‘ì› ë™ë¬¼ */
        .cheer-animal {
            position: absolute; font-size: 40px; z-index: 5;
            animation: bounce 1s infinite alternate;
        }

        /* UI ë ˆì´ì–´ */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 20;
            display: flex; flex-direction: column; align-items: center;
        }

        #quiz-box {
            pointer-events: auto; display: none; margin-top: 50px;
            background: rgba(255, 255, 255, 0.95);
            padding: 25px; border-radius: 30px; border: 6px solid #4CAF50;
            text-align: center; width: 85%; max-width: 400px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        #timer { font-size: 30px; color: #e53935; font-weight: bold; margin: 10px; }
        #question { font-size: 45px; margin: 20px 0; color: #1b5e20; font-weight: bold; }
        input { font-size: 30px; width: 120px; text-align: center; border-radius: 15px; border: 3px solid #ddd; padding: 5px; margin-bottom: 15px; }
        button { font-size: 24px; padding: 10px 30px; background: #4CAF50; color: white; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; }

        /* ê²°ê³¼ í™”ë©´ */
        #result-screen {
            pointer-events: auto; display: none; position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; padding: 40px; border-radius: 30px;
            text-align: center; width: 80%; box-shadow: 0 0 50px rgba(0,0,0,0.5); z-index: 100;
        }

        /* ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-15px); } }
        .sparkle { position: absolute; pointer-events: none; animation: pop 0.5s forwards; font-size: 30px; z-index: 50; }
        @keyframes pop { 0% { transform: scale(0); opacity: 1; } 100% { transform: scale(2) translateY(-50px); opacity: 0; } }
        .star-rain { position: absolute; font-size: 30px; animation: fall 3s linear infinite; z-index: 100; }
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }
        .sweat { position: absolute; font-size: 20px; top: -10px; right: -10px; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="giant-tree"></div>
    <div id="rabbit">ğŸ°</div>
    <div id="monster">ğŸ§™â€â™‚ï¸</div>
    <div id="stair-container"></div>
    
    <div id="ui-layer">
        <div id="quiz-box">
            <div id="speech" style="font-size: 18px; color: #444; margin-bottom: 10px;"></div>
            <div id="timer">20</div>
            <div id="question">5 + 3 = ?</div>
            <input type="number" id="answer-input" pattern="\d*">
            <br>
            <button onclick="checkAnswer()">ì œì¶œí•˜ê¸°</button>
        </div>
    </div>

    <div id="result-screen">
        <h1 id="result-title">ê²Œì„ ì¢…ë£Œ!</h1>
        <p id="result-stats" style="font-size: 22px;"></p>
        <div id="reward" style="font-size: 50px; margin: 20px;"></div>
        <button onclick="location.reload()">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
    </div>
</div>

<script>
    const rabbit = document.getElementById('rabbit');
    const monster = document.getElementById('monster');
    const quizBox = document.getElementById('quiz-box');
    const questionEl = document.getElementById('question');
    const inputEl = document.getElementById('answer-input');
    const timerEl = document.getElementById('timer');
    const speechEl = document.getElementById('speech');
    const stairContainer = document.getElementById('stair-container');

    let currentStep = 0;
    let score = 0;
    let timer;
    let timeLeft = 20;
    let currentAns = 0;
    const totalQuestions = 20;

    // ê³„ë‹¨ ìƒì„± (ë‚˜ì„ í˜• ë°°ì¹˜)
    function buildStairs() {
        for (let i = 0; i < totalQuestions + 2; i++) {
            const stair = document.createElement('div');
            stair.className = 'stair';
            const angle = i * 0.8;
            const x = Math.sin(angle) * 110 + (window.innerWidth / 2) - 60;
            const y = window.innerHeight - (i * 80) - 100;
            stair.style.left = x + 'px';
            stair.style.top = y + 'px';
            stairContainer.appendChild(stair);
        }
    }

    // ìºë¦­í„° ìœ„ì¹˜ ì—…ë°ì´íŠ¸
    function updateRabbit() {
        const angle = currentStep * 0.8;
        const x = Math.sin(angle) * 110 + (window.innerWidth / 2) - 30;
        const y = window.innerHeight - (currentStep * 80) - 160;
        rabbit.style.left = x + 'px';
        rabbit.style.top = y + 'px';
    }

    // ë¬¸ì œ ìƒì„± (1í•™ë…„ ë‚œì´ë„ ì¡°ì ˆ)
    function makeQuestion() {
        let n1, n2;
        if (currentStep < 5) { // í•œìë¦¬ + í•œìë¦¬
            n1 = Math.floor(Math.random() * 9) + 1;
            n2 = Math.floor(Math.random() * 9) + 1;
        } else if (currentStep < 15) { // ë‘ìë¦¬ + í•œìë¦¬
            n1 = Math.floor(Math.random() * 20) + 10;
            n2 = Math.floor(Math.random() * 9) + 1;
        } else { // ë‘ìë¦¬ + ë‘ìë¦¬
            n1 = Math.floor(Math.random() * 40) + 10;
            n2 = Math.floor(Math.random() * 40) + 10;
        }
        currentAns = n1 + n2;
        questionEl.innerText = `${n1} + ${n2} = ?`;
    }

    async function gameLoop() {
        if (currentStep >= totalQuestions) {
            endGame(true);
            return;
        }

        // 1. í† ë¼ê°€ í˜ë“¤ì–´í•˜ë©° ì˜¤ë¥´ê¸° (3ì´ˆ)
        rabbit.innerHTML = 'ğŸ°<span class="sweat">ğŸ’¦</span>';
        if (Math.random() > 0.6) spawnFriend();
        
        await new Promise(r => setTimeout(r, 2000));
        currentStep++;
        updateRabbit();
        rabbit.innerHTML = 'ğŸ°';

        // 2. ê´´ë¬¼ ì„ ìƒë‹˜ ë“±ì¥
        monster.style.display = 'block';
        monster.style.left = (parseInt(rabbit.style.left) + 20) + 'px';
        monster.style.top = (parseInt(rabbit.style.top) - 100) + 'px';
        
        speechEl.innerText = `ì•ˆë…• ì •ì•„ì¸! ë¬¸ì œë¥¼ ë§íˆë©´ ë” ê°ˆ ìˆ˜ ìˆì–´!`;
        quizBox.style.display = 'block';
        makeQuestion();
        inputEl.value = '';
        inputEl.focus();
        startTimer();
    }

    function startTimer() {
        timeLeft = 20;
        timerEl.innerText = timeLeft;
        timer = setInterval(() => {
            timeLeft--;
            timerEl.innerText = timeLeft;
            if (timeLeft === 10 || timeLeft === 5) playDing();
            if (timeLeft <= 0) {
                clearInterval(timer);
                endGame(false, "ì‹œê°„ì´ ë‹¤ ëì–´!");
            }
        }, 1000);
    }

    function playDing() {
        const ding = document.createElement('div');
        ding.className = 'sparkle';
        ding.innerText = 'ğŸ”” ëµ!';
        ding.style.left = '50%'; ding.style.top = '100px';
        document.body.appendChild(ding);
        setTimeout(() => ding.remove(), 500);
    }

    function checkAnswer() {
        if (parseInt(inputEl.value) === currentAns) {
            clearInterval(timer);
            score++;
            jumpEffect();
            quizBox.style.display = 'none';
            monster.style.display = 'none';
            gameLoop();
        } else {
            endGame(false, "ì•—! í‹€ë ¸ì–´!");
        }
    }

    function jumpEffect() {
        rabbit.style.transform = 'translateY(-50px) scale(1.2)';
        const star = document.createElement('div');
        star.className = 'sparkle';
        star.innerText = 'âœ¨ ë°˜ì§!';
        star.style.left = rabbit.style.left;
        star.style.top = rabbit.style.top;
        document.body.appendChild(star);
        setTimeout(() => {
            rabbit.style.transform = 'translateY(0) scale(1)';
            star.remove();
        }, 500);
    }

    function spawnFriend() {
        const friends = ['ğŸ¿ï¸', 'ğŸ¤', 'ğŸ¦‹', 'ğŸ¼'];
        const f = document.createElement('div');
        f.className = 'cheer-animal';
        f.innerText = friends[Math.floor(Math.random()*friends.length)];
        f.style.left = Math.random() * (window.innerWidth - 50) + 'px';
        f.style.top = (parseInt(rabbit.style.top) + 100) + 'px';
        document.body.appendChild(f);
        
        const msg = document.createElement('div');
        msg.style.position = 'absolute';
        msg.style.top = '-30px'; msg.style.width = '100px';
        msg.style.fontSize = '14px'; msg.style.fontWeight = 'bold';
        msg.innerText = "ì•„ì¸ì•„ í˜ë‚´!";
        f.appendChild(msg);
        
        setTimeout(() => f.remove(), 3000);
    }

    function endGame(isWin, msg = "") {
        clearInterval(timer);
        quizBox.style.display = 'none';
        monster.style.display = 'none';
        
        const screen = document.getElementById('result-screen');
        const stats = document.getElementById('result-stats');
        const reward = document.getElementById('reward');
        screen.style.display = 'block';

        if (!isWin) {
            rabbit.style.opacity = '0'; // ë§ˆë²•ìœ¼ë¡œ ì‚¬ë¼ì§
            document.getElementById('result-title').innerText = "ì•—! ì•„ì¸ì•„ ê´œì°®ì•„!";
            stats.innerText = msg + `\n${totalQuestions}ë¬¸ì œ ì¤‘ ${score}ë¬¸ì œë¥¼ ë§ì·„ì–´!\nì ìˆ˜: ${(score/totalQuestions)*100}ì `;
        } else {
            document.getElementById('result-title').innerText = "ì™€! 20ë¬¸ì œ ì™„ë“± ì„±ê³µ!";
            stats.innerText = `ì™„ë²½í•´ ì •ì•„ì¸!\nì ìˆ˜: 100ì !`;
            reward.innerText = "ğŸŸï¸ ì†Œì›ê¶Œ";
            startStarRain();
        }
    }

    function startStarRain() {
        for(let i=0; i<30; i++) {
            setTimeout(() => {
                const s = document.createElement('div');
                s.className = 'star-rain';
                s.innerText = 'â­';
                s.style.left = Math.random() * 100 + 'vw';
                s.style.top = '-50px';
                document.body.appendChild(s);
            }, i * 100);
        }
    }

    buildStairs();
    updateRabbit();
    setTimeout(gameLoop, 1000);
</script>
</body>
</html>
