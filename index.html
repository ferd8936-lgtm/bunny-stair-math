<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì•„ì´ë‹ˆì˜ í•˜ëŠ˜ë‚˜ë¼ ìˆ˜í•™êµì‹¤</title>
    <style>
        @font-face {
            font-family: 'NexonGothic';
            src: url('./NexonLv2Gothic_2.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        :root {
            --sky-top: #4facfe;
            --sky-bottom: #a1eafb;
            --tree-deep: #3e2723;
            --tree-mid: #5d4037;
            --tree-light: #795548;
            --tree-width: 320px;
        }

        * { font-family: 'NexonGothic', sans-serif !important; }

        body { 
            margin: 0; 
            overflow: hidden; 
            background: var(--sky-bottom); 
            user-select: none; 
            touch-action: manipulation; 
        }

        #game-container { position: relative; width: 100vw; height: 100vh; background: linear-gradient(to bottom, var(--sky-top) 0%, var(--sky-bottom) 100%); overflow: hidden; }
        
        .cloud-bg {
            position: absolute; background: white; border-radius: 50px; opacity: 0.6;
            filter: blur(4px); animation: float 15s infinite linear; z-index: 0;
        }
        @keyframes float { 
            from { transform: translateX(-200px); } 
            to { transform: translateX(120vw); } 
        }

        #start-screen {
            position: absolute; width: 100%; height: 100%; z-index: 500;
            background: rgba(255, 255, 255, 0.95); display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center;
        }
        .start-rabbit { font-size: 80px; margin-bottom: 10px; animation: bounce 2s infinite; }
        .game-title {
            font-size: 34px; color: #2e7d32; line-height: 1.4; font-weight: 800; margin-bottom: 30px;
        }

        .btn-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; width: 90%; max-width: 400px; }
        .step-btn {
            padding: 20px 5px; font-size: 21px; font-weight: bold; border: none; border-radius: 15px;
            background: #fff; border: 3px solid #81c784; color: #2e7d32; cursor: pointer;
            box-shadow: 0 4px 0 #66bb6a;
        }
        .step-btn:active { transform: translateY(2px); box-shadow: 0 1px 0 #66bb6a; }

        #game-world { position: relative; width: 100vw; height: 100vh; transition: transform 0.8s ease-in-out; }

        .giant-tree { 
            position: absolute; left: 50%; bottom: -3000px; width: var(--tree-width); height: 10000px; 
            background: linear-gradient(90deg, var(--tree-deep) 0%, var(--tree-mid) 25%, var(--tree-light) 50%, var(--tree-mid) 75%, var(--tree-deep) 100%);
            transform: translateX(-50%); border-radius: 60px; z-index: 1; box-shadow: inset 0 0 80px rgba(0,0,0,0.5);
        }

        .stair { position: absolute; width: 130px; height: 25px; background: linear-gradient(to bottom, #fff59d, #fbc02d); border-radius: 20px; z-index: 5; border: 2px solid #f9a825; }

        #rabbit-group { position: absolute; z-index: 10; transition: all 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        #rabbit { font-size: 65px; line-height: 1; }

        #rabbit-bubble {
            position: absolute; background: #fff; border: 3px solid #ff80ab; padding: 5px 12px;
            border-radius: 15px; font-size: 18px; font-weight: 800; color: #d81b60; white-space: nowrap; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: none; z-index: 11; top: 0;
        }

        #ui-layer { position: absolute; top: 20px; left: 0; width: 100%; pointer-events: none; z-index: 100; display: flex; flex-direction: column; align-items: center; }
        
        #quiz-box { 
            pointer-events: auto; display: none; background: rgba(255, 255, 255, 0.98); 
            padding: 10px 15px; border-radius: 30px; border: 8px solid #81c784; 
            text-align: center; 
            width: 90%; max-width: 345px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            margin-top: 10px; box-sizing: border-box;
        }

        #remain-info { font-size: 24px; color: #666; font-weight: bold; margin-bottom: 2px; }
        #timer { font-size: 24px; color: #ff5252; font-weight: bold; margin-bottom: 2px; }
        
        /* 1. ë¬¸ì œ ìˆ«ì í¬ê¸° 40% í™•ëŒ€ (24px -> ì•½ 34px) */
        #question { font-size: 34px; margin: 2px 0; color: #2e7d32; font-weight: 900; }
        
        /* 1. ë¬¸ì œ ìˆ«ìì™€ ìˆ«ì í‚¤ë³´ë“œ ì‚¬ì´ ì„¸ë¡œ ì—¬ë°± 50% ì¶•ì†Œ (ê¸°ì¡´ answer-display ë†’ì´ ì¡°ì •) */
        #answer-display { font-size: 24px; height: 15px; margin-bottom: 2px; line-height: 15px; font-weight: bold; color: #1b5e20; }
        
        /* 1. ìˆ«ì í‚¤ë³´ë“œ ì•ˆ ìˆ«ì ë³¼ë“œ ì²˜ë¦¬ ë° ë ˆì´ì•„ì›ƒ */
        #numpad { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; margin-bottom: 5px; }
        .num-btn { 
            font-size: 22px; 
            padding: 6px 0; 
            background: #fff; 
            border: 2px solid #81c784; 
            border-radius: 10px; 
            cursor: pointer; 
            color: #2e7d32; 
            box-shadow: 0 2px 0 #66bb6a;
            font-weight: 800 !important; /* ë³¼ë“œ ì²˜ë¦¬ */
        }
        
        #numpad-control { display: flex; gap: 8px; }
        .control-btn { flex: 1; font-size: 20px; padding: 10px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; color: #fff; }
        #btn-clear { background: #ef5350; box-shadow: 0 3px 0 #c62828; }
        #btn-submit { background: #66bb6a; box-shadow: 0 3px 0 #2e7d32; }

        #stats-screen { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 25px; border-radius: 30px; border: 8px solid #ffd54f; text-align: center; display: none; z-index: 600; width: 75%; max-width: 300px; }
        
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body>

<div id="game-container">
    <div class="cloud-bg" style="top: 10%; width: 100px; height: 30px; animation-duration: 12s;"></div>
    <div class="cloud-bg" style="top: 25%; width: 150px; height: 45px; animation-duration: 18s; animation-delay: -2s;"></div>
    <div class="cloud-bg" style="top: 40%; width: 120px; height: 35px; animation-duration: 15s; animation-delay: -5s;"></div>

    <div id="start-screen">
        <div class="start-rabbit">ğŸ°</div>
        <div class="game-title">ì•„ì´ë‹ˆì˜<br>í•˜ëŠ˜ë‚˜ë¼ ìˆ˜í•™êµì‹¤</div>
        <div class="btn-grid">
            <button class="step-btn" onclick="startGame(1)">1ë‹¨ê³„<br>(ë‘ìë¦¬ ë”í•˜ê¸°)</button>
            <button class="step-btn" onclick="startGame(2)">2ë‹¨ê³„<br>(ë‘ìë¦¬ ë¹¼ê¸°)</button>
            <button class="step-btn" onclick="startGame(3)">3ë‹¨ê³„<br>(ì„¸ìë¦¬ ë”í•˜ê¸°)</button>
            <button class="step-btn" onclick="startGame(4)">4ë‹¨ê³„<br>(ì„¸ìë¦¬ ë¹¼ê¸°)</button>
        </div>
    </div>

    <div id="game-world">
        <div class="giant-tree"></div>
        <div id="stair-container"></div>
        <div id="rabbit-group">
            <div id="rabbit-bubble"></div>
            <div id="rabbit">ğŸ°</div>
        </div>
    </div>

    <div id="ui-layer">
        <div id="quiz-box">
            <div id="remain-info"></div>
            <div id="timer">ğŸ•’ 15</div>
            <div id="question"></div>
            <div id="answer-display"></div>
            <div id="numpad">
                <button class="num-btn" onclick="addNum(1)">1</button>
                <button class="num-btn" onclick="addNum(2)">2</button>
                <button class="num-btn" onclick="addNum(3)">3</button>
                <button class="num-btn" onclick="addNum(4)">4</button>
                <button class="num-btn" onclick="addNum(5)">5</button>
                <button class="num-btn" onclick="addNum(6)">6</button>
                <button class="num-btn" onclick="addNum(7)">7</button>
                <button class="num-btn" onclick="addNum(8)">8</button>
                <button class="num-btn" onclick="addNum(9)">9</button>
                <button class="num-btn" onclick="addNum(0)">0</button>
            </div>
            <div id="numpad-control">
                <button id="btn-clear" class="control-btn" onclick="clearAns()">ì§€ìš°ê¸°</button>
                <button id="btn-submit" class="control-btn" onclick="checkAnswer()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <div id="stats-screen">
        <h1 style="color: #f57c00; font-size: 24px;">ê²°ê³¼</h1>
        <p id="stats-content" style="font-size: 18px; line-height: 1.6; font-weight: bold;"></p>
        <div id="reward-icon" style="font-size: 60px; margin: 10px;">ğŸ°</div>
        <button onclick="location.reload()" style="font-size: 18px; padding: 10px 25px; background: #ffa726; color: #fff; border: none; border-radius: 20px;">ì²˜ìŒìœ¼ë¡œ</button>
    </div>
</div>

<script>
    const audioCorrect = new Audio('https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3'); 
    const audioWin = new Audio('https://assets.mixkit.co/active_storage/sfx/1432/1432-preview.mp3');

    const gameWorld = document.getElementById('game-world');
    const rabbitGroup = document.getElementById('rabbit-group');
    const rabbitBubble = document.getElementById('rabbit-bubble');
    const quizBox = document.getElementById('quiz-box');
    const questionEl = document.getElementById('question');
    const timerEl = document.getElementById('timer');
    const remainEl = document.getElementById('remain-info');
    const answerDisplay = document.getElementById('answer-display');
    const startScreen = document.getElementById('start-screen');

    let currentLvl = 0;
    let score = 0;
    let timer;
    let timeLeft = 15;
    let correctVal = 0;
    let inputVal = "";
    let gameStep = 1;
    const totalQuest = 15;

    const cheerMessages = ["ì˜í•œë‹¤!", "í˜ë‚´!", "ë©‹ì ¸ìš”!", "ì¢‹ì•„!", "ìµœê³ !", "í™”ì´íŒ…!"];

    function startGame(step) {
        gameStep = step;
        startScreen.style.display = 'none';
        initStairs();
        updateRabbitPosition();
        updateCamera();
        setTimeout(startTurn, 500);
    }

    function initStairs() {
        const container = document.getElementById('stair-container');
        for (let i = 0; i < totalQuest + 5; i++) {
            const s = document.createElement('div');
            s.className = 'stair';
            const angle = i * 0.9;
            const x = Math.sin(angle) * 120 + (window.innerWidth / 2) - 65;
            const y = window.innerHeight - (i * 90) - 120;
            s.style.left = x + 'px';
            s.style.top = y + 'px';
            container.appendChild(s);
        }
    }

    function updateCamera() {
        const rabbitY = window.innerHeight - (currentLvl * 90) - 185;
        const targetY = (window.innerHeight * 0.6) - rabbitY;
        gameWorld.style.transform = `translateY(${targetY}px)`; 
    }

    function updateRabbitPosition() {
        const angle = currentLvl * 0.9;
        const centerX = window.innerWidth / 2;
        const rabbitX = Math.sin(angle) * 120 + centerX - 65;
        const y = window.innerHeight - (currentLvl * 90) - 185; 
        
        rabbitGroup.style.left = rabbitX + 'px';
        rabbitGroup.style.top = y + 'px';

        if (rabbitX + 32 < centerX) { 
            rabbitBubble.style.left = "75px";
            rabbitBubble.style.right = "auto";
        } else {
            rabbitBubble.style.left = "auto";
            rabbitBubble.style.right = "75px";
        }
    }

    function showRabbitSpeech(msg) {
        rabbitBubble.innerText = msg;
        rabbitBubble.style.display = 'block';
        setTimeout(() => rabbitBubble.style.display = 'none', 1500);
    }

    function makeQuiz() {
        let a, b, op;
        switch(gameStep) {
            case 1: a = Math.floor(Math.random() * 40) + 10; b = Math.floor(Math.random() * 40) + 10; op = "+"; correctVal = a + b; break;
            case 2: a = Math.floor(Math.random() * 50) + 40; b = Math.floor(Math.random() * 30) + 10; op = "-"; correctVal = a - b; break;
            case 3: 
                const h1 = Math.floor(Math.random() * 4) + 1; const t1 = Math.floor(Math.random() * 5); const o1 = Math.floor(Math.random() * 5);
                const h2 = Math.floor(Math.random() * 4) + 1; const t2 = Math.floor(Math.random() * 5); const o2 = Math.floor(Math.random() * 5);
                a = h1 * 100 + t1 * 10 + o1; b = h2 * 100 + t2 * 10 + o2; op = "+"; correctVal = a + b; break;
            case 4: 
                const h3 = Math.floor(Math.random() * 5) + 4; const t3 = Math.floor(Math.random() * 9); const o3 = Math.floor(Math.random() * 9);
                const h4 = Math.floor(Math.random() * (h3 - 1)) + 1; const t4 = Math.floor(Math.random() * (t3 + 1)); const o4 = Math.floor(Math.random() * (o3 + 1));
                a = h3 * 100 + t3 * 10 + o3; b = h4 * 100 + t4 * 10 + o4; op = "-"; correctVal = a - b; break;
        }
        questionEl.innerText = `${a} ${op} ${b} = ?`;
        remainEl.innerText = `ë‚¨ì€ ë¬¸ì œ: ${totalQuest - currentLvl}ê°œ`;
        clearAns();
    }

    function addNum(n) { if(inputVal.length < 4) { inputVal += n; answerDisplay.innerText = inputVal; } }
    function clearAns() { inputVal = ""; answerDisplay.innerText = ""; }

    function startTurn() {
        if (currentLvl >= totalQuest) { endGame(true); return; }
        currentLvl++;
        updateRabbitPosition();
        updateCamera();
        setTimeout(() => {
            const randomMsg = cheerMessages[Math.floor(Math.random() * cheerMessages.length)];
            showRabbitSpeech(randomMsg);
            quizBox.style.display = 'block';
            makeQuiz();
            startTimer();
        }, 800);
    }

    function startTimer() {
        timeLeft = 15;
        timerEl.innerText = `ğŸ•’ ${timeLeft}`;
        clearInterval(timer);
        timer = setInterval(() => {
            timeLeft--;
            timerEl.innerText = `ğŸ•’ ${timeLeft}`;
            if (timeLeft <= 0) endGame(false, "ì‹œê°„ì´ ë‹¤ ëì–´ìš”!");
        }, 1000);
    }

    function checkAnswer() {
        if (inputVal === "") return;
        if (parseInt(inputVal) === correctVal) {
            clearInterval(timer);
            score++;
            audioCorrect.play();
            quizBox.style.display = 'none';
            setTimeout(startTurn, 300);
        } else { endGame(false, "ì•—! í‹€ë ¸ì–´ìš”."); }
    }

    function endGame(win, msg="") {
        clearInterval(timer);
        quizBox.style.display = 'none';
        const screen = document.getElementById('stats-screen');
        screen.style.display = 'block';
        if (win) {
            audioWin.play();
            document.getElementById('stats-content').innerText = `${totalQuest}ë¬¸ì œ ì¤‘ì— ${score}ë¬¸ì œë¥¼ ë§í˜”ì–´ìš”!\nì •ë§ ëŒ€ë‹¨í•´ìš”!`;
        } else {
            document.getElementById('stats-content').innerText = `${msg}\n${totalQuest}ë¬¸ì œ ì¤‘ì— ${score}ë¬¸ì œë¥¼ ë§í˜”ì–´ìš”.`;
        }
    }
</script>
</body>
</html>
